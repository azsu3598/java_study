### ORM이란?

- 자바의 객체와 데이터베이스를 연결하는 프로그래밍 기법이다.

#### 장점과 단점

- 장점 1 : SQL을 직접 작성하지 않고 사용하는 언어로 데이터베이스에 접근할 수 있다.
- 장점 2 : 객체지향적으로 코드를 작성할수 있기 때문에 비즈니스 로직에만 집중할 수 있다.
- 장점 3 : 데이터베이스 시스템에 대한 종속석이 줄어든다.
- 장점 4 : 매핑하는 정보가 명확하기 때문에 ERD에 대한 의존도를 낮출 수 있고 유지보수할 때 유리하다.
- 단점 1 : 프로젝트의 복잡성이 커질수록 사용 난이도가 올라간다.
- 단점 2 : 복잡하고 무거운 쿼리는 ORM으로 해결이 불가능한 경우가 있다.

### JPA와 하이버네이트?

- JPA : 자바에서 관계형 데이터베이스를 사용하는 방식을 정의한 인터페이스
- 자바 객체와 데이터베이스를 연결해 데이터를 관리한다, 객체 지향 도메인 모델과 데이터베이스의 다리 역할을 한다.
- ORM 프레임워크를 추가로 선택해야한다.
- 하이버네이트 : JPA 인터페이스를 구현한 구현체이자 자바용 ORM 프레임워크이다.
- 내부적으로 JDBC API를 사용한다.

#### 엔티티 매니저란?

- 엔티티 : 데이터베이스의 테이블과 매핑되는 객체
- **엔티티 매니저** : 엔티티를 관리해 데이터베이스와 애플리케이션 사이에서 객체를 생성, 수정, 삭제하는 등의 역할을 한다.
- 엔티티 매니저 팩토리에서 만들어진다.
- 스프링 부트는 내부에서 엔티티 매니저 팩토리를 하나만 생성해서 관리하고 @PersistenceContext 또는 @Autowired 애너테이션을 사용해서 엔티티 매니저를 사용한다.
- ```java
  @PersistenceContext
  EntityManager em; // 프록시 엔티티 매니저. 필요할 때 진짜 엔티티 매니저 호출
  ```

#### 영속성 컨텍스트란?

- JPA의 중요한 특징 중 하나로, 엔티티를 관리하는 가상의 공간이다.

##### 1차 캐시

- 영속성 컨텍스트는 내부에 1차 캐시를 갖는다.
- 캐시의 키는 엔티티의 @Id 애너테이션이 달린 기본키 역할을 하는 식별자이며 값을 엔티티이다.
- 엔티티 조회 시 1차 캐시에서 데이터를 조회하여 값을 반환하고, 없을 시에 데이터 베이스에서 조회해 1차 캐시에 저장후 반환한다.
- 이를 통해 매우 빠르게 데이터를 조회 할 수 있다.

#### 쓰기 지연

- 트랜잭션을 커밋하기 전까지는 데이터베이스에 실제로 질의문을 보내지 않고 쿼리를 모았다가 트랜잭션을 커밋하면 모았던 쿼리를 한번에 실행하는 것을 의미한다.
- 이를 통해 데이터베이스 시스템의 부담을 줄일 수 있다.

#### 변경 감지

- 트랜잭션을 커밋하면 1차 캐시에 저장되어 있는 엔티티의 값과 현재 엔티티의 값을 비교해서 변경된 값이 있다면 변경 사항을 감지해 변경된 값을 데이터베이스에 자동으로 반영한다.
- 이를 통해 적당한 묶음으로 쿼리를 요청할 수 있고, 데이터베이스 시스템의 부담을 줄일 수 있다.

#### 지연 로딩

- 필욯라 때 쿼리를 날려 데이터를 조회하는것을 의미한다.

### 엔티티의 상태

- 분리상태, 관리상태, 비영속상태, 삭제된상태 존재
- 1. 엔티티를 처음 만들면 엔티티는 **비영속 상태**가 된다.
- 2. persist() 메서드를 사용해 엔티티를 **관리 상태**로 반들 수 있으며, 영속성 컨텍스트에서 상태가 관리된다.
- 3. detach() 메서드를 사요해 **분리 상태**로 만들 수 있다.
- 4. remove() 메서드를 사용해서 엔티티를 영속성 컨텍스트와 데이터베이스에서 삭제할 수 있다.

## 스프링 데이터와 스프링 데이터 JPA

### 스프링 데이터 JPA란?

- 스프링 데이터의 공통적인 기능에서 JPA의 유용한 기술이 추가된 기술이다.
- JpaRepository 인터페이스를 인터페이스에 상속받아 사용한다.
- ```java
  public interface MemberRepository extedns JpaRepository<Member, Long>{}
  ```
- 제네릭에는 관리할<엔티티 이름, 엔티티 기본키의 타입>을 입력하면 기본 CRUD 메서드를 사용할 수 있다.

### 핵심 요약

- 1. **_ORM_**은 객체와 데이터베이스를 연결하는 프로그래밍 기법이다.
- 2. **_JPA_**는 자바에서 관계형 데이터베이스를 사용하는 방식을 정의한 인터페이스이다.
  - 엔티티는 영속성을 가진 객체를 의미한다.
  - 엔티티 매니저는 엔티티를 조회, 삭제, 수정, 생성하는 역할을 한다.
  - 엔티티 매니저를 만드는 곳이 엔티티 매니저 팩토리이다.
  - 엔티티 매니저는 엔티티를 영속성 컨텍스트에 저장한다는 특징이 있다.
  - 영속성 컨텍스트는 1차 캐시, 쓰기 지연, 변경 감지, 지연 로딩의 특징을 갖는다.
  - 엔티티의 상태는 분리, 관리, 비영속, 삭제 상태로 나뉜다.
- 3. **_하이버네이트_**는 JPA의 대표적인 구현체로, 자바 언어를 위한 ORM 프레임워크이다.
- 4. **_스프링 데이터 JPA_**는 JPA를 쓰기 편하게 만들어 놓은 모듈이다.
